import{a as w}from"./chunk-4EIDCPOJ.js";import"./chunk-KBNISIIW.js";var R=(e=>(e.EXPORT_MANIFEST="scene/export_manifest.json",e.CODE_PREFIX="scene/code",e.PROPERTIES="scene/code/properties.json",e.EDITOR="scene/editor.json",e.ASSETS="scene/assets.json",e.POLYGONJS="js/all.js",e.SCENE_DATA_LOADER="js/sceneDataLoader.js",e.POLY_CONFIG="js/polyConfig.js",e.JS_FILES="scene/js_files.json",e.POSTER="images/poster.png",e))(R||{});var g=class{static async importSceneData(s){s.editorMode==null&&(s.editorMode=!1);let r=s.manifest,n=s.urlPrefix||R.CODE_PREFIX,a=Object.keys(r.nodes),c=[];for(let o of a){let t=r.nodes[o],A=`${n}/root/${o}.json?t=${t}`;c.push(A)}let i=`${n}/root.json?t=${r.root}`,l=`${n}/properties.json?t=${r.properties}`,u=[i,l];if(s.editorMode){let o=Date.now();u.push(`${n}/ui.json?t=${o}`)}for(let o of c)u.push(o);let P=0,M=u.length,S=o=>{let t=w.sceneData;s.onProgress&&s.onProgress(t.start+t.mult*o)},E=u.map(async o=>{let t=await fetch(o);return P++,S(P/M),t}),d=await Promise.all(E),p=[];for(let o of d)p.push(await o.json());let h={root:p[0],properties:p[1]},m=2;s.editorMode&&(h.ui=p[2],m+=1);let f={},_=Object.keys(r.nodes);for(let o=0;o<_.length;o++){let t=_[o],A=p[o+m];f[t]=A}return this.assemble(h,_,f)}static async assemble(s,r,n){let a={root:s.root,properties:s.properties,ui:s.ui};for(let c=0;c<r.length;c++){let i=r[c],l=n[i];this.insert_child_data(a.root,i,l)}return a}static insert_child_data(s,r,n){let a=r.split("/");if(a.length==1)s.nodes||(s.nodes={}),s.nodes[r]=n;else{let c=a.shift(),i=a.join("/"),l=s.nodes[c];this.insert_child_data(l,i,n)}}};var v="1649725777413",B="1649725777413",I={positionalAudio1:"1649725777413","positionalAudio1/COP":"1649725777413","positionalAudio1/eventsNetwork1":"1649725777413",geo1:"1649725777413","geo1/COP":"1649725777413","geo1/MAT":"1649725777413",crowd:"1649725777413","crowd/MAT":"1649725777413","crowd/MAT/meshLambertBuilder_INSTANCES":"1649725777413","crowd/MAT/meshStandardBuilder1":"1649725777413","crowd/MAT/meshPhongBuilder_ground":"1649725777413",planeWithTexture:"1649725777413","planeWithTexture/COP":"1649725777413","planeWithTexture/MAT":"1649725777413",waveform:"1649725777413","waveform/MAT":"1649725777413","waveform/MAT/lineBasicBuilder_FFT_asOctaves_SPEED":"1649725777413","waveform/MAT/lineBasicBuilder_FFT_asOctaves_VALUE":"1649725777413","waveform/MAT/lineBasicBuilder_FFT_raw_VALUE":"1649725777413",particles:"1649725777413","particles/particlesSystemGpu1":"1649725777413","particles/particlesSystemGpu1/subnet_FORCE_FROM_MUSIC":"1649725777413","particles/particlesSystemGpu1/subnet_CURSOR_FORCE":"1649725777413","particles/particlesSystemGpu1/subnet_RANDOMISE_MASS":"1649725777413","particles/MAT":"1649725777413","particles/MAT/pointsParticles":"1649725777413","particles/MAT/meshLambertBuilder_INSTANCES":"1649725777413","particles/MAT/meshBasicBuilder_PARTICLES":"1649725777413","particles/MAT/meshBasicBuilder_PARTICLES/ifThen1":"1649725777413","particles/eventsNetwork1":"1649725777413",blackSphere:"1649725777413","blackSphere/materialsNetwork1":"1649725777413",raycastTarget:"1649725777413",perspectiveCamera_DEBUG:"1649725777413","perspectiveCamera_DEBUG/events1":"1649725777413",perspectiveCamera_MAIN:"1649725777413","perspectiveCamera_MAIN/eventsNetwork1":"1649725777413","perspectiveCamera_MAIN/animationsNetwork1":"1649725777413",env:"1649725777413","env/MAT":"1649725777413","env/MAT/meshBasicBuilder1":"1649725777413","env/COP":"1649725777413",eventsNetwork_light_shadow:"1649725777413"},O={properties:v,root:B,nodes:I};var j=async e=>{let s=e.sceneDataRoot||"./polygonjs/scenes";return await g.importSceneData({urlPrefix:s+"/scene_01",manifest:O,onProgress:e.onProgress})};var $=async function(e){let{onProgress:s,domElement:r,configureSceneData:n,autoPlay:a,sceneDataRoot:c,assetsRoot:i,libsRootPrefix:l}=e,u=e.runRegister!=null?e.runRegister:!0,M=(e.loadModules!=null?e.loadModules:!0)?["EXRLoader","OBJLoader"]:[],S=M.map(t=>import("./modules/"+t+(e.moduleImportSuffix||""))),E=[import("./loadSceneFromSceneData-6CIM6SNO.js"),j({onProgress:s,sceneDataRoot:c}),...S],d=await Promise.all(E),{Poly:p,loadSceneFromSceneData_scene_01:h}=d[0],m=d[1];n&&n(m);let f=[];for(let t=2;t<d.length;t++)f.push(d[t]);let _=0;for(let t of M){let A=t+"Module";p.registerModule(f[_][A]),_++}return await h({onProgress:s,sceneData:m,domElement:r,runRegister:u,autoPlay:a,assetsRoot:i,libsRootPrefix:l})};export{$ as loadSceneAndMountAsync_scene_01};
