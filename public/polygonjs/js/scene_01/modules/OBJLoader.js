import"../chunk-BYXBJQAS.js";import{A as k,b as _,k as M,o as B,p as O,t as N,u as R,v as I,w as C,x as F,z as D}from"../chunk-MDUSK33Y.js";import{$b as H,Vb as J,ac as T}from"../chunk-4CCWYKQJ.js";import"../chunk-KBNISIIW.js";var Q=/^[og]\s*(.+)?/,X=/^mtllib /,Y=/^usemtl /,Z=/^usemap /,q=new _,E=new _,W=new _,K=new _,v=new _,A=new J;function $(){let P={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(s,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=s,this.object.fromDeclaration=t!==!1;return}let o=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:s||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,i){let a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);let f={index:this.materials.length,name:e||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(j){let y={index:typeof j=="number"?j:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return y.clone=this.clone.bind(y),y}};return this.materials.push(f),f},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){let i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),e&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return e&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},o&&o.name&&typeof o.clone=="function"){let e=o.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(s,t){let o=parseInt(s,10);return(o>=0?o-1:o+t/3)*3},parseNormalIndex:function(s,t){let o=parseInt(s,10);return(o>=0?o-1:o+t/3)*3},parseUVIndex:function(s,t){let o=parseInt(s,10);return(o>=0?o-1:o+t/2)*2},addVertex:function(s,t,o){let e=this.vertices,i=this.object.geometry.vertices;i.push(e[s+0],e[s+1],e[s+2]),i.push(e[t+0],e[t+1],e[t+2]),i.push(e[o+0],e[o+1],e[o+2])},addVertexPoint:function(s){let t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addVertexLine:function(s){let t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addNormal:function(s,t,o){let e=this.normals,i=this.object.geometry.normals;i.push(e[s+0],e[s+1],e[s+2]),i.push(e[t+0],e[t+1],e[t+2]),i.push(e[o+0],e[o+1],e[o+2])},addFaceNormal:function(s,t,o){let e=this.vertices,i=this.object.geometry.normals;q.fromArray(e,s),E.fromArray(e,t),W.fromArray(e,o),v.subVectors(W,E),K.subVectors(q,E),v.cross(K),v.normalize(),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z)},addColor:function(s,t,o){let e=this.colors,i=this.object.geometry.colors;e[s]!==void 0&&i.push(e[s+0],e[s+1],e[s+2]),e[t]!==void 0&&i.push(e[t+0],e[t+1],e[t+2]),e[o]!==void 0&&i.push(e[o+0],e[o+1],e[o+2])},addUV:function(s,t,o){let e=this.uvs,i=this.object.geometry.uvs;i.push(e[s+0],e[s+1]),i.push(e[t+0],e[t+1]),i.push(e[o+0],e[o+1])},addDefaultUV:function(){let s=this.object.geometry.uvs;s.push(0,0),s.push(0,0),s.push(0,0)},addUVLine:function(s){let t=this.uvs;this.object.geometry.uvs.push(t[s+0],t[s+1])},addFace:function(s,t,o,e,i,a,f,j,y){let z=this.vertices.length,c=this.parseVertexIndex(s,z),u=this.parseVertexIndex(t,z),n=this.parseVertexIndex(o,z);if(this.addVertex(c,u,n),this.addColor(c,u,n),f!==void 0&&f!==""){let r=this.normals.length;c=this.parseNormalIndex(f,r),u=this.parseNormalIndex(j,r),n=this.parseNormalIndex(y,r),this.addNormal(c,u,n)}else this.addFaceNormal(c,u,n);if(e!==void 0&&e!==""){let r=this.uvs.length;c=this.parseUVIndex(e,r),u=this.parseUVIndex(i,r),n=this.parseUVIndex(a,r),this.addUV(c,u,n),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(s){this.object.geometry.type="Points";let t=this.vertices.length;for(let o=0,e=s.length;o<e;o++){let i=this.parseVertexIndex(s[o],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(s,t){this.object.geometry.type="Line";let o=this.vertices.length,e=this.uvs.length;for(let i=0,a=s.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(s[i],o));for(let i=0,a=t.length;i<a;i++)this.addUVLine(this.parseUVIndex(t[i],e))}};return P.startObject("",!1),P}var G=class extends H{constructor(s){super(s);this.materials=null}load(s,t,o,e){let i=this,a=new T(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(s,function(f){try{t(i.parse(f))}catch(j){e?e(j):console.error(j),i.manager.itemError(s)}},o,e)}setMaterials(s){return this.materials=s,this}parse(s){let t=new $;s.indexOf(`\r
`)!==-1&&(s=s.replace(/\r\n/g,`
`)),s.indexOf(`\\
`)!==-1&&(s=s.replace(/\\\n/g,""));let o=s.split(`
`),e="",i="",a=0,f=[],j=typeof"".trimLeft=="function";for(let c=0,u=o.length;c<u;c++)if(e=o[c],e=j?e.trimLeft():e.trim(),a=e.length,a!==0&&(i=e.charAt(0),i!=="#"))if(i==="v"){let n=e.split(/\s+/);switch(n[0]){case"v":t.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(A.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])).convertSRGBToLinear(),t.colors.push(A.r,A.g,A.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":t.uvs.push(parseFloat(n[1]),parseFloat(n[2]));break}}else if(i==="f"){let r=e.slice(1).trim().split(/\s+/),p=[];for(let m=0,b=r.length;m<b;m++){let h=r[m];if(h.length>0){let d=h.split("/");p.push(d)}}let g=p[0];for(let m=1,b=p.length-1;m<b;m++){let h=p[m],d=p[m+1];t.addFace(g[0],h[0],d[0],g[1],h[1],d[1],g[2],h[2],d[2])}}else if(i==="l"){let n=e.substring(1).trim().split(" "),r=[],p=[];if(e.indexOf("/")===-1)r=n;else for(let g=0,m=n.length;g<m;g++){let b=n[g].split("/");b[0]!==""&&r.push(b[0]),b[1]!==""&&p.push(b[1])}t.addLineGeometry(r,p)}else if(i==="p"){let r=e.slice(1).trim().split(" ");t.addPointGeometry(r)}else if((f=Q.exec(e))!==null){let n=(" "+f[0].slice(1).trim()).slice(1);t.startObject(n)}else if(Y.test(e))t.object.startMaterial(e.substring(7).trim(),t.materialLibraries);else if(X.test(e))t.materialLibraries.push(e.substring(7).trim());else if(Z.test(e))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(i==="s"){if(f=e.split(" "),f.length>1){let r=f[1].trim().toLowerCase();t.object.smooth=r!=="0"&&r!=="off"}else t.object.smooth=!0;let n=t.object.currentMaterial();n&&(n.smooth=t.object.smooth)}else{if(e==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+e+'"')}t.finalize();let y=new R;if(y.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let c=0,u=t.objects.length;c<u;c++){let n=t.objects[c],r=n.geometry,p=n.materials,g=r.type==="Line",m=r.type==="Points",b=!1;if(r.vertices.length===0)continue;let h=new B;h.setAttribute("position",new M(r.vertices,3)),r.normals.length>0&&h.setAttribute("normal",new M(r.normals,3)),r.colors.length>0&&(b=!0,h.setAttribute("color",new M(r.colors,3))),r.hasUVIndices===!0&&h.setAttribute("uv",new M(r.uvs,2));let d=[];for(let L=0,U=p.length;L<U;L++){let w=p[L],S=w.name+"_"+w.smooth+"_"+b,l=t.materials[S];if(this.materials!==null){if(l=this.materials.create(w.name),g&&l&&!(l instanceof F)){let V=new F;O.prototype.copy.call(V,l),V.color.copy(l.color),l=V}else if(m&&l&&!(l instanceof I)){let V=new I({size:10,sizeAttenuation:!1});O.prototype.copy.call(V,l),V.color.copy(l.color),V.map=l.map,l=V}}l===void 0&&(g?l=new F:m?l=new I({size:1,sizeAttenuation:!1}):l=new k,l.name=w.name,l.flatShading=!w.smooth,l.vertexColors=b,t.materials[S]=l),d.push(l)}let x;if(d.length>1){for(let L=0,U=p.length;L<U;L++){let w=p[L];h.addGroup(w.groupStart,w.groupCount,L)}g?x=new D(h,d):m?x=new C(h,d):x=new N(h,d)}else g?x=new D(h,d[0]):m?x=new C(h,d[0]):x=new N(h,d[0]);x.name=n.name,y.add(x)}else if(t.vertices.length>0){let c=new I({size:1,sizeAttenuation:!1}),u=new B;u.setAttribute("position",new M(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(u.setAttribute("color",new M(t.colors,3)),c.vertexColors=!0);let n=new C(u,c);y.add(n)}return y}};var ee={moduleName:"OBJLoader",module:G};export{ee as OBJLoaderModule};
